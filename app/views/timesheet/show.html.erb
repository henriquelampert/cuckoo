<p id="notice"><%= notice %></p>

<!-- Primary menu with the datetime, days control, calendar and user -->
<div class="container row">

  <div class="pagination span5">
    <h2 class="pull-left"><%= @date.strftime("%A, %d %b") %></h2>
  </div>

 <nav class="span4 pull-right" id="timesheet-controls">

    <ul class="pager span2 pull-right">
      <li><a href='#' class="icon-calendar"></a></li>
      <li><a href='#' class="icon-user"></a></li>
    </ul>

    <div class="pagination pull-right">

      <ul>
          <li class="previous">
            <%= link_to '', timesheet_url(today_date(@date.yesterday)), class: 'icon-arrow-left' %>
          </li>
          <li<%= ' class="active"'.html_safe if @date.to_date == Time.zone.now.to_date %>>
            <%= link_to 'Today', timesheet_url %>
          </li>
          <li class="next">
            <%= link_to '', timesheet_url(today_date(@date.tomorrow)), class: 'icon-arrow-right' %>
          </li>
      </ul>

    </div>

  </nav>

</div>

<!-- Header of table with weekdays synchronized with primary menu above and the DB in table below -->
<div class="pagination pagination-large week">
  <ul>
    <% Date::DAYNAMES.each_with_index do |weekday,constant_day| %>

      <li <% if constant_day == @date.wday %> class="active" <% end %>>
        <%= link_to weekday, timesheet_url(today_date(@date.advance({days: constant_day-@date.wday}))) %>
        </a>
      </li>
    <% end %>
  </ul>
</div>


<!-- New Entry button-->
<%= link_to '<i class="icon-plus-sign icon-white"></i>
             New Entry'.html_safe,
             new_time_entry_path( working_date(params) ),
             class: 'btn btn-inverse btn-large entry-position' %>


<!-- Table with the time entries -->
<table class="table table-striped table-list">
  <!-- Header of table with the time entries variables -->
  <thead>
    <tr>
      <% if @day_entries.empty? %>

        <th>
          <div class="text-center alert alert-info">
            <%= t :no_time_entry %>
          </div>
        </th>

      <% else %>

        <th>Activity</th>
        <th>Time</th>
        <th>Duration</th>
        <th>Actions</th>

      <% end %>
    </tr>
  </thead>
  <tbody>

    <% unless @day_entries.empty? %>

      <% @day_entries.each do |time_entry| %>

        <tr>

          <td class="row-fluid span6">
            <ul class="breadcrumb row-fluid span10">

              <!-- Project | Task > Description  -->
              <li>

                <% if time_entry.project %>
                  <blockquote class="pull-left">
                    <p class="pull-left">
                      <%= time_entry.project.name %>
                    </p>
                  </blockquote>
                <% end %>

                <% if time_entry.task %>
                  <% if time_entry.project %>
                    <span class="divider pull-left">|</span>
                  <% end %>
                  <blockquote class="pull-left">
                    <p class="pull-left">
                      <%= time_entry.task.name %>
                    </p>
                  </blockquote>
                <% end %>

                <% unless time_entry.description.empty? %>
                  <% if time_entry.project || time_entry.task %>
                    <span class="divider pull-left">></span>
                  <% end %>
                  <blockquote class="pull-left">
                    <p class="pull-left">
                      <%= time_entry.description %>
                    </p>
                  </blockquote>
                <% end %>

              </li>

            </ul>
          </td>

          <td class="row-fluid span1">

            <!-- Started_at and Ended_at Time column -->
            <div class="row-fluid span12">
              <blockquote>
                <h5 class="started_at">
                  <%= time_entry.started_at.strftime("%H:%M") %>
                </h5>
              </blockquote>
              <blockquote>
                <h5 class="ended_at">
                  <%= time_entry.ended_at.strftime("%H:%M") unless time_entry.ended_at.nil? %>
                </h5>
              </blockquote>
            </div>

          </td>

          <td class="row-fluid span4">

            <% if time_entry.ended_at.present? %>

              <!-- Timer -->
              <div class="count-holder stopped" data-id="<%= (time_entry.ended_at - time_entry.started_at).ceil %>">

                <!-- timer hh:mm:ss -->
                <% ['days','hours','minutes','seconds'].each_with_index do |elem,i| %>

                  <span class="count-<%= elem %>">
                    <span class="position">
                      <span class="digit static">0</span>
                    </span>
                    <span class="position">
                      <span class="digit static">0</span>
                    </span>
                  <% if elem != "seconds" %>
                    <span class="count-div count-div-<%= i %>"></span>
                  <% end %>
                  </span>

                <% end %>

              </div>

              <!-- Pass the parameters too-->
              <div class="row-fluid span12">
                 <%= start_button(time_entry) %>
              </div>

            <% else %>

              <div class="count-holder running" data-id="<%= (Time.zone.now - time_entry.started_at).ceil %>" >

                <% ['days','hours','minutes','seconds'].each_with_index do |elem,i| %>

                <!-- timer hh:mm:ss -->
                  <span class="count-<%= elem %>">
                    <span class="position">
                      <span class="digit static">0</span>
                    </span>
                    <span class="position">
                      <span class="digit static">0</span>
                    </span>
                  <% if elem != "seconds" %>
                    <span class="count-div count-div-<%= i %>"></span>
                  <% end %>
                  </span>

                <% end %>

              </div>

              <div class="row-fluid span12">

                <%= link_to 'Stop'.html_safe, time_entry_finish_path( time_entry.id,
                                                                    { time_entry: { ended_at: '' } }),
                                                                      method: 'PATCH',
                                                                      class: 'btn btn-warning btn-small stop_button' %>

                <%= start_button(time_entry, 'none') %>
              </div>

            <% end %>

          </td>
          <td class="row-fluid span1">

            <div class="btn-group">
              <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">
                <i class="icon-edit icon-white"></i>
                <span class="caret"></span>
              </a>

              <ul class="dropdown-menu">
                  <li>
                    <%= link_to '<i class="icon-edit"></i> Edit'.html_safe, edit_time_entry_path(time_entry) %>
                  </li>
                  <li>
                    <%= link_to '<i class="icon-trash"></i> Destroy'.html_safe,time_entry, method: :delete, data: { confirm: 'Are you sure?' } %>
                  </li>
                </ul>

            </div>

          </td>
        </tr>

      <% end %><!-- end for @day_entries loop -->

    <% end %><!-- end for unless @day_entries.empty? -->

  </tbody>

</table>